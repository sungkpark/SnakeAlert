<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="stylesheets/splash.css" type="text/css" media="screen">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <title>Snakes and ladders: a 2 to 4 player game</title>

    <script>
        var status = "SPLASH";

        var socket = new WebSocket("ws://localhost:3000");
        socket.onmessage = function(event){
            const data = JSON.parse(event.data);
            switch(data.action){
                case "UPDATE_STATS":
                    console.log("BOO");
                    $("#connected").html("Players online: " + data.pConnected);
                    $("#started").html("Number of games started: " + data.gStarted);
                    $("#completed").html("Number of games completed: " + data.gCompleted);
                    break;

                case "UPDATE_PAGE":
                    $('head').append('<link rel="stylesheet" type="text/css" href="stylesheets/game.css">');
                    $(document.body).html(data.nHTML);
                    $("#gameID").html("Game ID: " + data.gID);
                    $("#playerConnected").html("Players connected: " + data.players.length + "/" + data.nPlayers);
                    for(var i = 0; i < data.nPlayers; i++){
                        var playerString = "#player" + (i + 1);
                        if(typeof data.players[i] !== 'undefined') {
                            $(playerString).html("Player" + (i + 1) + ": " + data.players[i].name);
                        }else{
                            $(playerString).html("Player" + (i + 1) + ": " +"...");
                        }
                    }
                    break;
            }
        }
        socket.onopen = function(){
            getStats();
        };

        // Get live statistics updates every second while in splash
        setInterval(function() {
            if(status=="SPLASH"){    
                getStats();
            }else{
                clearInterval();
            }
        }, 1000);

        function getStats(){
            const message = {action: "GET_STATS"};
            const json = JSON.stringify(message);
            socket.send(json);
        }

        function createGame(){
            console.log("here");
            var nPlayers = 2;
            if($("#radio3").prop('checked')){
                nPlayers = 3;
            }else if($("#radio4").prop('checked')){
                nPlayers = 4;
            }
            const pName = $("#pName").val();
            const game = {action: "CREATE_GAME", players: nPlayers, name: pName};
            const json = JSON.stringify(game);
            socket.send(json);
        }
        
        // Create a random name 
        $(document).ready(function(){
            const rNumber = Math.floor((Math.random() * 10000) + 1);
            $("#pName").attr("value", "Guest" + rNumber);
        });
    </script>
</head>
<body>
    <h1 align="center">Snakes & Ladders</h1>
    <section>
        
        <h2 align="center">Number of players</h2>
        <div class="numPlayers"> 
            <input type="radio" name="numPlayers" value="2" id="radio2" checked="true"><font size="10">II</font></input type="radio">
            <input type="radio" name="numPlayers" value="3" id="radio3"><font size="10">III</font></input type="radio">
            <input type="radio" name="numPlayers" value="4" id="radio4"><font size="10">IV</font></input type="radio">
        </div>
    </section>
    <br><br>
    <h2 align="center">Name</h2>
    <input type="text" id="pName" />
    <br><br><br>
    <section>
        <div align="center">
            <input type="submit" value="Play" onclick="createGame()" />
        </div>
    </section>
    <br>
    <section>
        <table align="center" border="1">
            <tr>
                <td>
                    <h3>How to play</h3>
                    <p>You just have to choose the options here for </p>
                    <p>starting and then just click on the dice when</p>
                    <p>it's your turn...</p>
                </td>
                <td>
                    <h3>Statistics</h3>
                    <p id="connected">Players online: 0</p>
                    <p id="started">Number of games started: </p>
                    <p id="completed">Number of games completed: </p>
                </td>
            </tr>
        </table>
    </section>
</body>
</html>
